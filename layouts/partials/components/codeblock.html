{{ $filename := .filename | default "" -}}
{{ $filename_uri_base := .filename_uri_base | default "" -}}
{{ $lang := .lang | default "" }}
{{ $content := .content }}
{{ $options := .options | default (dict) }}

{{- if $filename -}}
  <div class="filename not-prose" dir="auto">
    {{- if $filename_uri_base -}}

      {{- $filename_uri_base = strings.TrimSuffix "/" $filename_uri_base -}}
      {{- $filename = strings.TrimPrefix "/" $filename -}}
      {{- $file_uri := urls.JoinPath $filename_uri_base $filename -}}

      <a class="hx-no-underline hx-inline-flex hx-items-center hx-gap-1" href="{{ $file_uri }}" target="_blank" rel="noopener noreferrer">
          {{- $filename -}}
          {{- partial "utils/icon" (dict "name" "external-link" "attributes" "height=1em") -}}
      </a>
    {{- else -}}
      {{- $filename -}}
    {{- end -}}
  </div>
{{- end -}}

{{- if transform.CanHighlight $lang -}}
  <div>{{- highlight $content $lang $options -}}</div>
{{- else -}}
  <pre><code>{{ $content }}</code></pre>
{{- end -}}
